generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model SepoliaHead {
  id   Int    @id
  hash String @db.VarChar

  @@map("sepolia_head")
}


model BridgeRequest {
  id                      Int                  @id @default(autoincrement())
  amount                  String               @db.VarChar
  asset                   String               @db.VarChar
  source_address          String               @db.VarChar
  destination_address     String               @db.VarChar
  source_transaction      String?              @db.VarChar
  destination_transaction String?              @db.VarChar
  source_chain            Chain                
  destination_chain       Chain                
  status                  BridgeRequestStatus
  failure_reason          FailureReason?
  failures                FailedBridgeRequest[]

  @@index([source_address], map: "index_bridge_request_on_source_address")
  @@index([destination_address], map: "index_bridge_request_on_destination_address")

}

model FailedBridgeRequest {
  id                      Int                  @id @default(autoincrement())
  bridge_request_id       Int?
  bridge_request          BridgeRequest?        @relation(fields: [bridge_request_id], references: [id])
  failure_reason          FailureReason

}

enum Chain {
  IRONFISH
  ETHEREUM
  @@map("chain_name")
}

enum BridgeRequestStatus {
  CREATED
  PENDING_PRETRANSFER
  PENDING_ON_DESTINATION_CHAIN
  CONFIRMED
  FAILED
  @@map("bridge_request_status")
}

model BridgeHead {
  hash      String   @db.VarChar @unique
}


enum FailureReason {
  REQUEST_NON_EXISTENT
  REQUEST_INVALID_STATUS
  REQUEST_SOURCE_ADDRESS_NOT_MATCHING
  REQUEST_AMOUNT_NOT_MATCHING
  REQUEST_ASSET_NOT_MATCHING
  @@map("failure_reason")
}